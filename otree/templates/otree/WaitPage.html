{% extends "global/Base.html" %}
{% load i18n %}
{% load staticfiles %}
{% block head_title %}{{ title_text }}{% endblock %}

{% block internal_styles %}
    {{ block.super }}
    <style>
        body {
            background-color: #c0c0c0;
        }

        div.panel-primary {
            background: white;
            border: 1px solid #3b84c3;
            border-radius: 5px;
            box-shadow: 0 0 20px #999;
            /*width: 940px; */
            margin: 22px auto;
        }

        div.panel-body {
            margin-top: 10px;
        }

        div.page-header {
           border: 1px solid #c0c0c0;
        }
    </style>
{% endblock %}


{% block current %}
    {{ body_text }}
{% endblock %}


{% block otherballoon %}
    <div id="waitMessage">...</div>
{% endblock %}

{% block selfballoon %}
    Your turn...
{% endblock %}



<div id="error-notice" class="alert alert-danger" style="display:none">
    {% blocktrans %}An error occurred. Please check the logs or ask the administrator for help.{% endblocktrans %}
</div>
<div id="error-traceback" class="alert alert-danger" style="display:none"></div>


{% block internal_scripts %}
    {{ block.super }}
    <!-- this is an HTML file rather than JavaScript static file because context variables need to be passed to it -->
<script type="text/javascript">
$(document).ready(function () {

    var socket;

    initWebSocket();
    loopWaitMessages();

    var waitMessages=[];
    waitMessages[0]="...mmm...";
    waitMessages[1]="...let me think...";
    waitMessages[2]="...one more second...";



    function loopWaitMessages(){
        var i=0;
        window.setInterval(function(){
            $("#waitMessage").html(waitMessages[i++]);
            if(i>waitMessages.length){
                i=0;
            }
        },6000);
    }

    function initWebSocket() {

        var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
        var ws_path = ws_scheme + '://' + window.location.host + "{{ view.socket_url|safe }}";
        socket = new ReconnectingWebSocket(ws_path);
        socket.onmessage = function(e) {

            var data = JSON.parse(e.data);

            // Handle errors
            if (data.error) {
                // maybe the div's default text doesn't get shown
                $("#error-notice").text(data.error);
                $("#error-notice").show();
                if (data.traceback) {
                    $("#error-traceback").html('<pre>' + data.traceback + '</pre>');
                    $("#error-traceback").show();
                }
                return;
            }


            console.log('Received redirect message', e.data);
            window.location.href = '{{ view.redirect_url|safe }}';

        };
        socket.onopen = function() {
            console.log('WebSocket connected');
        };
        socket.onclose = function() {
            console.log('WebSocket disconnected');
        };
    }

 });
 </script>
 {% endblock %}

